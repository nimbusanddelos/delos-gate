<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="delos-key" content="v1">
  <title>Delos Gate</title>
  <style>body{font-family:Arial;background:#000;color:#0f0;text-align:center;padding:50px;}h1{font-size:2em;}</style>
</head>
<body>
  <h1>‚ö° Delos Circle Gate ‚ö°</h1>
  <p id="status">Plug in YubiKey ‚Üí <strong>Touch the gold disc</strong> when it blinks</p>
<button onclick="registerKey()" style="margin-top:20px;padding:10px;background:#0f0;color:#000;border:none;font-weight:bold;">
  ‚ö° REGISTER YUBIKEY TO THIS GATE ‚ö°
</button>

<script>
async function registerKey() {
  const rpId = window.location.hostname; // "nimbusanddelos.github.io"
  const credential = await navigator.credentials.create({
    publicKey: {
      challenge: new TextEncoder().encode("delos-circle-register-2025"),
      rp: { name: "Delos Circle", id: rpId },
      user: {
        id: new TextEncoder().encode("wizard@nimbusanddelos"),
        name: "wizard",
        displayName: "Swamp Wizard"
      },
      pubKeyCredParams: [{ type: "public-key", alg: -7 }],
      authenticatorSelection: { userVerification: "required", residentKey: "required" },
      attestation: "direct"
    }
  });
  alert("‚úÖ YubiKey registered to " + rpId + "!\nNow tap to login.");
  location.reload();
}
</script>
  <script>
    async function delosHandshake() {
      document.getElementById("status").innerHTML = "üîµ Requesting key...";
      
      const challenge = new TextEncoder().encode("delos-circle-2025-wizard");
      const publicKey = {
        challenge: challenge,
        allowCredentials: [],
        userVerification: "required",
        timeout: 60000
      };

      try {
        const assertion = await navigator.credentials.get({ publicKey });
        document.getElementById("status").innerHTML = `
          <p style="color:#0f0;">‚úÖ DELOS KEY VERIFIED</p>
          <p><strong>WELCOME, WIZARD.</strong></p>
          <small>Key ID: ${assertion.id.slice(0,16)}...</small>
        `;
      } catch (err) {
        document.getElementById("status").innerHTML = `
          <p style="color:#f00;">‚ùå FAILED: ${err.message}</p>
          <p>Did you register your YubiKey yet?</p>
        `;
      }
    }

    // Auto-start when page loads
    if ('credentials' in navigator) {
      setTimeout(delosHandshake, 1000);
    } else {
      document.getElementById("status").innerHTML = "‚ùå WebAuthn not supported";
    }
  </script>
</body>
</html>